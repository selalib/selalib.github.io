
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Low-Level Layer: Basic Utilities</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Mid-Level Layer: Numerical and Parallel Utilities" href="mid_level.html" />
    <link rel="prev" title="Preamble" href="user_guide.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/selalib.png" class="logo" alt="logo">
  
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Mathematics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="equations.html">
   Equations
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  User guide
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="build.html">
   Build the library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="user_guide.html">
   Preamble
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Low-Level Layer: Basic Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mid_level.html">
   Mid-Level Layer: Numerical and Parallel Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="top_level.html">
   Top-Level Layer: Semi-Lagrangian Toolbox
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Developer guide
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cmake.html">
   CMake
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="structure.html">
   Libraries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coding_style.html">
   Coding guidelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="naming_convention.html">
   Naming Convention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="doxygen.html">
   Doxygen
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Credits
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markdown.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="members.html">
   Contributors
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/low_level.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/selalib/selalib.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/selalib/selalib.github.io/issues/new?title=Issue%20on%20page%20%2Flow_level.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/selalib/selalib.github.io/edit/main/low_level.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numeric-types">
   Numeric Types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#description">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exposed-interface">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#usage">
     Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#memory-allocator">
   Memory Allocator
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assertions">
   Assertions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Usage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-notes">
     Developer notes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#timing-utility">
   Timing Utility
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constants">
   Constants
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     Exposed Interface
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#logical-meshes">
   Logical Meshes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#file-io">
   File IO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     Description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     Exposed Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#critical-commentary">
     Critical Commentary
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="low-level-layer-basic-utilities">
<h1>Low-Level Layer: Basic Utilities<a class="headerlink" href="#low-level-layer-basic-utilities" title="Permalink to this headline">¶</a></h1>
<div class="section" id="numeric-types">
<h2>Numeric Types<a class="headerlink" href="#numeric-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>As a <em>convenience</em>, Selalib offers aliases to some of Fortran’s basic
numeric types. This is intended to:</p>
<ol class="simple">
<li><p>concisely and uniformly make clear the intended precision of a given
variable,</p></li>
<li><p>permit mixed precision representations when needed (for example, a
developer could wish to represent a particular real number with a
combination of a 32-bit integer and a 32-bit real instead of a
single 64-bit real as is sometimes done in ultra-high performance
software), and</p></li>
<li><p>provide a centralized location to change the precision of a
numerical representation program-wide.</p></li>
</ol>
</div>
<div class="section" id="exposed-interface">
<h3>Exposed Interface<a class="headerlink" href="#exposed-interface" title="Permalink to this headline">¶</a></h3>
<p>Selalib’s numeric precision features are accessed through the following
aliases:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>alias</p></th>
<th class="head"><p>shorthand for…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sll_int32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer(kind=i32)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sll_int64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer(kind=i64)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sll_real32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">real(kind=f32)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sll_real64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">real(kind=f64)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sll_int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integer(kind=user)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sll_real</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">real(kind=user)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sll_comp32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">complex(kind=f32)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sll_comp64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">complex(kind=f64)</span></code></p></td>
</tr>
</tbody>
</table>
<p>Where the kind type parameters <code class="docutils literal notranslate"><span class="pre">i32</span></code>, <code class="docutils literal notranslate"><span class="pre">i64</span></code>, <code class="docutils literal notranslate"><span class="pre">f32</span></code> and <code class="docutils literal notranslate"><span class="pre">f64</span></code> have been
defined to give a representation that is at least the denoted size for a
given number. <code class="docutils literal notranslate"><span class="pre">user</span></code> is available for a flexible kind type parameter.
These kind type parameters can also be used to specify the precision of
numerical constants in the usual Fortran way, i.e. <code class="docutils literal notranslate"><span class="pre">3.14159265_f32</span></code>. The
use of these constants is encouraged for development within the library
as then we can in principle change the numeric precision library-wide if
needed with only a parameter change.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>To use the module in a stand-alone way, use the line:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;sll_working_precision.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>These types are to be used like the native Fortran types that they are
aliasing:</p>
</div>
</div>
<div class="section" id="memory-allocator">
<h2>Memory Allocator<a class="headerlink" href="#memory-allocator" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Description<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Selalib’s memory allocators are simple wrappers around Fortran’s native
allocators. We ask very little from these allocators:</p>
<ol class="simple">
<li><p>to allocate memory,</p></li>
<li><p>to initialize it if requested (only for Fortran-native types),</p></li>
<li><p>to deallocate memory, and</p></li>
<li><p>to fail with as descriptive a message as possible.</p></li>
</ol>
</div>
<div class="section" id="id2">
<h3>Exposed Interface<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The interface to these allocators follows very closely the interface of
Fortran’s <code class="docutils literal notranslate"><span class="pre">allocate()</span></code> and <code class="docutils literal notranslate"><span class="pre">deallocate()</span></code> functions, except for a
mandatory integer variable argument which does not need to be
initialized. The user may decide to allocate arrays or pointers of any
type, and up to the same number of dimensions as permitted by a given
Fortran implementation. The exposed macros are:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_ALLOCATE</span><span class="p">(</span> <span class="n">array_and_lims</span><span class="p">,</span> <span class="n">ierr</span> <span class="p">)</span>
</pre></div>
</div>
<p>This is the basic memory allocator with the same syntax as Fortran’s
native <code class="docutils literal notranslate"><span class="pre">allocate()</span></code> but with a required integer error parameter. Any
type and dimension that the native fortran allocator would accept can be
given as the argument <code class="docutils literal notranslate"><span class="pre">array_and_lims</span></code>.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_CLEAR_ALLOCATE</span><span class="p">(</span> <span class="n">array_and_lims</span><span class="p">,</span> <span class="n">ierr</span> <span class="p">)</span>
</pre></div>
</div>
<p>Same behavior as <code class="docutils literal notranslate"><span class="pre">SLL_ALLOCATE()</span></code> but also initializes the allocated
memory to zero. This works for Fortran native types only or for derived
types for which an assignment operator (<span class="math notranslate nohighlight">\(= 0\)</span>) has been defined.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_DEALLOCATE</span><span class="p">(</span> <span class="n">array_and_lims</span><span class="p">,</span> <span class="n">ierr</span> <span class="p">)</span>
</pre></div>
</div>
<p>Basic deallocator. It is a wrapper around Fortran’s native
<code class="docutils literal notranslate"><span class="pre">deallocate()</span></code> function but also nullifies the pointer given as an
argument after deallocation. This is a difference between the native
Fortran routine and this wrapper, as we have thus needed to distinguish
between the call that deallocates a pointer and a simple array:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_DEALLOCATE_ARRAY</span><span class="p">(</span> <span class="k">array</span><span class="p">,</span> <span class="n">ierr</span> <span class="p">)</span>
</pre></div>
</div>
<p>The array deallocator differs from the previous in that it does not
attempt to nullify the array name after the deallocation is complete.
This and the previous macro could in principle be merged into one for
simplification.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_INIT_ARRAY</span><span class="p">(</span> <span class="k">array</span><span class="p">,</span> <span class="n">val</span> <span class="p">)</span>
</pre></div>
</div>
<p>While not really an allocator/deallocator, we expose this macro for
convenience in initializing an array with a given constant value. For
consistency, it may be decided to eliminate this from the interface.</p>
</div>
<div class="section" id="id3">
<h3>Usage<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>To use the memory module in stand-alone fashion, use the line:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;sll_memory.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>An example of the use of the module is:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">err</span>
<span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">a</span>
<span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">b</span><span class="o">=&gt;</span><span class="nb">null</span><span class="p">()</span>

<span class="n">SLL_ALLOCATE</span><span class="p">(</span> <span class="n">a</span><span class="p">(</span><span class="mi">5000</span><span class="p">),</span> <span class="n">err</span> <span class="p">)</span>
<span class="n">SLL_CLEAR_ALLOCATE</span><span class="p">(</span> <span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
<span class="n">SLL_INIT_ARRAY</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>When finding an error condition, the user is informed about the location
of the failing call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Memory</span> <span class="n">allocation</span> <span class="n">Failure</span><span class="o">.</span> <span class="n">Triggered</span> <span class="ow">in</span> <span class="n">FILE</span> <span class="n">tester</span><span class="o">.</span><span class="n">F90</span><span class="p">,</span> 
<span class="ow">in</span> <span class="n">LINE</span><span class="p">:</span>   <span class="mi">35</span>
<span class="n">STOP</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">test_error_code</span><span class="p">():</span> <span class="n">exiting</span> <span class="n">program</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Description<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>This is a very small but very useful capability that permits the
developer to devise many sorts of defensive programming techniques. The
simple idea is that of declaring a condition that is expected to be
true, thus triggering a descriptive error if the condition is violated.
The assertions are only present while compiling the library in <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>
mode, thus any overhead associated with the test can be eliminated by
changing the type of compilation. For this reason, the types of tests
that should be permanent should not be implemented with the assert
facility.</p>
</div>
<div class="section" id="id5">
<h3>Exposed Interface<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Wherever a specific condition needs to be asserted, simply write:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">SLL_ASSERT</span><span class="p">(</span> <span class="n">logical_condition</span> <span class="p">)</span>
</pre></div>
</div>
<p>Thus the condition to be checked must be cast in the form of a logical
statement. Falseness of such statement would trigger an assertion error.</p>
<p>The assertions can be used liberally since they are controlled by a
<code class="docutils literal notranslate"><span class="pre">-DEBUG</span></code> flag at compilation time (<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> compilation mode). Absence of
this flag (i.e. in <code class="docutils literal notranslate"><span class="pre">RELEASE</span></code> compilation mode) will delete all calls to
<code class="docutils literal notranslate"><span class="pre">SLL_ASSERT()</span></code> from the code. Hence, assertion conditions can be used
during a debugging or testing phase without increasing the overhead in
production code.</p>
</div>
<div class="section" id="id6">
<h3>Usage<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>To use the <em>assertions</em> module in a stand-alone way, use the line:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;sll_assert.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>However, all the following steps are necessary:</p>
<p>An example may be the checking of in-range indices on a protected array:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">get_val</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span>

    <span class="n">sll_int32</span> <span class="kd">::</span> <span class="n">get_val</span>
    <span class="n">sll_int32</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
    <span class="n">sll_int32</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
    <span class="n">SLL_ASSERT</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span> <span class="p">.</span><span class="n">ge</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">i</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">get_val</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="k">end function </span><span class="n">get_val</span>
</pre></div>
</div>
<p>Which could produce a behavior such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./unit_test
  The size of a is: 1000
  a(1) =    0
  a(117) =    0
  Here we ask for the value of a(1001):

  (i .ge. 1) .and. (i .le. size(a)) : Assertion 
  error triggered in file unit_test.F90 in line       25
  STOP :  ASSERTION FAILURE
</pre></div>
</div>
<p>Such way of stopping a program is much less uncomfortable than the
sinking feeling one has when the program stops as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./unit_test
  Array values: 
  The size of a is: 1000
  a(1) =    0
  a(117) =    0
  Incident de segmentation (core dumped)
</pre></div>
</div>
<p>which of course doesn’t even need to happen at the moment of the first
error.</p>
</div>
<div class="section" id="developer-notes">
<h3>Developer notes<a class="headerlink" href="#developer-notes" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">SLL_ASSERT()</span>&#160;&#160;&#160; </code> macro needs some other macros to convert
parameters into strings, but the way to accomplish this may vary
depending on the compiler used. If problems are found, make sure
that the appropriate macro is used in the <code class="docutils literal notranslate"><span class="pre">sll_assert.h</span></code> to activate
the proper behavior of such macros. As an example, when using
<strong>gfortran</strong> compiler, notice the role played by the <code class="docutils literal notranslate"><span class="pre">-DGFORTRAN</span></code>
flag.</p></li>
<li><p>when using <strong>gfortran</strong>, use pass along the flag
<code class="docutils literal notranslate"><span class="pre">-ffree-line-length-none</span></code> to prevent compilation error as some of
the included macros may go beyond Fortrans 132 character limit. Use
the equivalent flag when changing compilers. All of this should be
set within CMake.</p></li>
</ol>
</div>
</div>
<div class="section" id="timing-utility">
<h2>Timing Utility<a class="headerlink" href="#timing-utility" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>When a high-resolution timer is available the measurable time interval
can be a bit smaller than 2 <span class="math notranslate nohighlight">\(\mu s\)</span>.</p>
</div>
<div class="section" id="id8">
<h3>Exposed Interface<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The module is imported by</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">sll_timer</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">include </span><span class="n">sll_timer</span>
</pre></div>
</div>
<p>which defines the type <code class="docutils literal notranslate"><span class="pre">sll_time_mark</span></code> which is meant to be treated as
an opaque object i.e. only interact with it through the methods defined
for it. An instance of this type can be used to measure time intervals
with the following routines:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">set_time_mark</span><span class="p">(</span> <span class="n">mark</span><span class="p">)</span>
<span class="n">time_elapsed_since</span><span class="p">(</span> <span class="n">mark</span> <span class="p">)</span>
<span class="n">time_elapsed_between</span><span class="p">(</span> <span class="n">mark_0</span><span class="p">,</span> <span class="n">mark_1</span> <span class="p">)</span>
</pre></div>
</div>
<dl class="simple myst">
<dt><code class="docutils literal notranslate"><span class="pre">set_time_mark(</span> <span class="pre">mark</span> <span class="pre">)</span></code></dt><dd><p>is a routine that takes an <code class="docutils literal notranslate"><span class="pre">sll_time_mark</span></code>
object and sets is internals to mark the time at the moment of the
routine call.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">time_elapsed_since(</span> <span class="pre">mark</span> <span class="pre">)</span></code></dt><dd><p>is a function that takes a time mark as an
argument and returns the time, <em>in seconds</em> between the clock reading
contained in the passed argument and the moment at which the function
was called.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">time_elapsed_between(</span> <span class="pre">mark_0,</span> <span class="pre">mark_1</span> <span class="pre">)</span></code></dt><dd><p>is a function which takes two
time marks that must have been set before obviously and will return the
time elapsed between them.</p>
</dd>
</dl>
</div>
<div class="section" id="id9">
<h3>Usage<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of the use of this module:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span> <span class="mi">1</span>     <span class="k">program </span><span class="n">timer_test</span>
 <span class="mi">2</span>     <span class="k">use </span><span class="n">sll_timer</span>
 <span class="mi">3</span>     <span class="k">implicit none</span>
<span class="k"> </span><span class="mi">4</span>     <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
 <span class="mi">5</span>     <span class="kt">real</span><span class="p">(</span><span class="kt">c_double</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">dt</span>
 <span class="mi">6</span>     <span class="k">type</span><span class="p">(</span><span class="n">sll_time_mark</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmark</span>
 <span class="mi">7</span>
 <span class="mi">8</span>     <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ITERATIONS</span> <span class="o">=</span> <span class="mi">1000</span>
 <span class="mi">9</span> 
 <span class="mi">10</span>    <span class="k">allocate</span><span class="p">(</span><span class="n">dt</span><span class="p">(</span><span class="n">ITERATIONS</span><span class="p">))</span>
 <span class="mi">11</span>
 <span class="mi">12</span>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ITERATIONS</span>
 <span class="mi">13</span>       <span class="k">call </span><span class="n">sll_set_time_mark</span><span class="p">(</span><span class="n">tmark</span><span class="p">)</span>
 <span class="mi">14</span>       <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">100000</span>    <span class="c">! Just a delay</span>
 <span class="mi">15</span>          <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">i</span>
 <span class="mi">16</span>       <span class="k">end do</span>
<span class="k"> </span><span class="mi">17</span>       <span class="n">dt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">sll_time_elapsed_since</span><span class="p">(</span><span class="n">tmark</span><span class="p">)</span> 
 <span class="mi">18</span>    <span class="k">end do</span>
<span class="k"> </span><span class="mi">19</span>    <span class="c">! print diagnostics here, averages, min, max, etc.</span>
 <span class="mi">20</span>    <span class="k">end program</span>
</pre></div>
</div>
<p>In brief:</p>
<dl class="simple myst">
<dt>Line 2:</dt><dd><p>Imports the timer module.</p>
</dd>
<dt>Line 5:</dt><dd><p>Here we define an array to store the results of the timing test.
This array stores the return values of the function
<code class="docutils literal notranslate"><span class="pre">time_elapsed_since()</span></code>, which returns a double precision value
(<code class="docutils literal notranslate"><span class="pre">sll_real64</span></code>).</p>
</dd>
<dt>Line 6:</dt><dd><p>Declaration of the time marker.</p>
</dd>
<dt>Lines 13:</dt><dd><p>Sets the time marker with a current clock reading.</p>
</dd>
<dt>Line 17:</dt><dd><p>We store the result of the timing operation.</p>
</dd>
</dl>
<p>Any number of time markers can be declared and set at different points.</p>
</div>
</div>
<div class="section" id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>Description<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Selalib provides a single file that specifies commonly used constants as
read-only parameters that can be used library-wide or by users.</p>
</div>
<div class="section" id="id11">
<h3>Exposed Interface<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Selalib simply defines a list of symbols, all in units of the
International System when applicable. To use, just write either</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">sll_constants</span>
</pre></div>
</div>
<p>The symbols defined are:</p>
<dl class="simple myst">
<dt>sll_pi</dt><dd><p>mathematical constant <span class="math notranslate nohighlight">\(\pi\)</span></p>
</dd>
<dt>sll_c</dt><dd><p>speed of light [<span class="math notranslate nohighlight">\(m/s\)</span>].</p>
</dd>
<dt>sll_epsilon_0</dt><dd><p>permittivity of free space (<span class="math notranslate nohighlight">\(\epsilon_0\)</span>) [<span class="math notranslate nohighlight">\(F/m\)</span>].</p>
</dd>
<dt>sll_mu_0</dt><dd><p>permeability of free space (<span class="math notranslate nohighlight">\(\mu_0\)</span>) [<span class="math notranslate nohighlight">\(N/A^2\)</span>].</p>
</dd>
<dt>sll_e_charge</dt><dd><p>fundamental charge [<span class="math notranslate nohighlight">\(C\)</span>].</p>
</dd>
<dt>sll_e_mass</dt><dd><p>mass of the electron [<span class="math notranslate nohighlight">\(kg\)</span>].</p>
</dd>
<dt>sll_proton_mass</dt><dd><p>mass of the proton [<span class="math notranslate nohighlight">\(kg\)</span>].</p>
</dd>
<dt>sll_g</dt><dd><p>gravitational acceleration at sea level [<span class="math notranslate nohighlight">\(m/s^2\)</span>]</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="logical-meshes">
<h2>Logical Meshes<a class="headerlink" href="#logical-meshes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id12">
<h3>Description<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Selalib solves its PDEs on structured grids<a class="footnote-reference brackets" href="#id19" id="id13">1</a>. Furthermore, the actual
solutions of the equations are carried out on rectangular, uniform grids
(i.e. cartesian) which within Selalib are referred to as <em>logical
meshes</em>. This means that when dealing with <em>physical domains</em> (i.e. the
actual geometry that is to be modeled) there is a coordinate
transformation that maps the logical mesh to the physical domain<a class="footnote-reference brackets" href="#id20" id="id14">2</a>.
Such coordinate transformations will be discussed on a different
chapter. Here we occupy ourselves with the description of the logical
mesh itself. The specification of a logical mesh is quite simple, as at
a minimum it only needs the number of cells in each dimension and the
values of the endpoints. As a convention, the coordinates in the logical
meshes are always referred to by the symbol <span class="math notranslate nohighlight">\(\eta\)</span>. Thus the coordinate
for the 1D mesh is <span class="math notranslate nohighlight">\(\eta_1\)</span>, for the 2D mesh they are <span class="math notranslate nohighlight">\(\eta_1\)</span> and
<span class="math notranslate nohighlight">\(\eta_2\)</span> and so on.</p>
</div>
<div class="section" id="id15">
<h3>Exposed Interface<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Public types:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">sll_logical_mesh_1d</span>
<span class="n">sll_logical_mesh_2d</span>
<span class="n">sll_logical_mesh_3d</span>
<span class="n">sll_logical_mesh_4d</span>
</pre></div>
</div>
<p>Routines:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">new_logical_mesh_1d</span><span class="p">(</span> <span class="n">num_cells</span><span class="p">,</span>         
                     <span class="n">eta1_min</span><span class="p">,</span> 
                     <span class="n">eta1_max</span> <span class="p">)</span>
                                              
<span class="n">new_logical_mesh_2d</span><span class="p">(</span> <span class="n">num_cells1</span><span class="p">,</span> 
                     <span class="n">num_cells2</span><span class="p">,</span> 
                     <span class="n">eta1_min</span><span class="p">,</span> 
                     <span class="n">eta1_max</span><span class="p">,</span> 
                     <span class="n">eta2_min</span><span class="p">,</span> 
                     <span class="n">eta2_max</span> <span class="p">)</span>
                          
<span class="n">new_logical_mesh_3d</span><span class="p">(</span> <span class="n">num_cells1</span><span class="p">,</span> 
                     <span class="n">num_cells2</span><span class="p">,</span>
                     <span class="n">num_cells3</span><span class="p">,</span> 
                     <span class="n">eta1_min</span><span class="p">,</span> 
                     <span class="n">eta1_max</span><span class="p">,</span> 
                     <span class="n">eta2_min</span><span class="p">,</span> 
                     <span class="n">eta2_max</span><span class="p">,</span> 
                     <span class="n">eta3_min</span><span class="p">,</span> 
                     <span class="n">eta3_max</span> <span class="p">)</span>
                         
<span class="n">new_logical_mesh_4d</span><span class="p">(</span> <span class="n">num_cells1</span><span class="p">,</span> 
                     <span class="n">num_cells2</span><span class="p">,</span>
                     <span class="n">num_cells3</span><span class="p">,</span>
                     <span class="n">num_cells4</span><span class="p">,</span> 
                     <span class="n">eta1_min</span><span class="p">,</span> 
                     <span class="n">eta1_max</span><span class="p">,</span> 
                     <span class="n">eta2_min</span><span class="p">,</span> 
                     <span class="n">eta2_max</span><span class="p">,</span> 
                     <span class="n">eta3_min</span><span class="p">,</span> 
                     <span class="n">eta3_max</span><span class="p">,</span> 
                     <span class="n">eta4_min</span><span class="p">,</span> 
                     <span class="n">eta4_max</span> <span class="p">)</span>          
                          
<span class="n">sll_display</span><span class="p">(</span> <span class="n">mesh</span> <span class="p">)</span>  <span class="c">! generic, for any mesh dimension      </span>
<span class="n">delete</span><span class="p">(</span> <span class="n">mesh</span> <span class="p">)</span>  <span class="c">! generic, for any mesh dimension</span>
</pre></div>
</div>
<p>The ‘new’ functions return pointers to allocated and initialized meshes.
All the parameters that specify the limits of the values of <em>eta</em> are
optional. These limits default to 0.0 and 1.0 for their minimum and
maximum values. The routine <code class="docutils literal notranslate"><span class="pre">sll_display(</span> <span class="pre">)</span></code> is helpful to show the
contents of a given mesh.</p>
<p>As a rare case in Selalib, the interface of the logical meshes permits
direct access to their internals. The slots available for each type are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_cellsX</span>
<span class="n">etaX_min</span>
<span class="n">etaX_max</span>
<span class="n">delta_etaX</span>
</pre></div>
</div>
<p>where ‘X’ stands for the index of the direction of interest (1, 2, 3,
etc.). Direct access is meant for reading, as the ‘new’ functions are
enough to produce duly initialized logical meshes. Thus a user can
directly access any of these slots as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="o">%</span><span class="n">delta_eta1</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h3>Usage<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span>  <span class="mi">1</span> <span class="k">program </span><span class="n">logical_meshes</span>
  <span class="mi">2</span> <span class="k">use </span><span class="n">sll_logical_meshes</span>
  <span class="mi">3</span>  <span class="k">implicit none</span>
<span class="k">  </span><span class="mi">4</span>
  <span class="mi">5</span>  <span class="k">type</span><span class="p">(</span><span class="n">sll_logical_mesh_2d</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">m2d</span>
  <span class="mi">6</span>  
  <span class="mi">7</span>  <span class="n">m2d</span> <span class="o">=&gt;</span> <span class="n">new_logical_mesh_2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
  <span class="mi">8</span>
  <span class="mi">9</span>  <span class="k">call </span><span class="n">sll_display</span><span class="p">(</span><span class="n">m2d</span><span class="p">)</span>
  <span class="mi">10</span>
  <span class="mi">11</span> <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">m2d</span><span class="p">)</span>
  <span class="mi">12</span> <span class="k">end program </span><span class="n">logical_meshes</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="file-io">
<h2>File IO<a class="headerlink" href="#file-io" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id17">
<h3>Description<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Presently, Selalib offers facilities to output data in the XDMF file
format, readable by the VisIt program. To use, import the module
<code class="docutils literal notranslate"><span class="pre">sll_file_io</span></code>. The interface allows to open a file, write
multi-dimensional data in it and then close it. The main purpose of this
module is to provide the low-level building blocks that can be used by
higher-level functions to conveniently write data to files.</p>
</div>
<div class="section" id="id18">
<h3>Exposed Interface<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>The current interface is a collection of generic functions:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">sll_xdmf_open</span><span class="p">(</span> <span class="n">file_name</span><span class="p">,</span>
               <span class="n">mesh_name</span><span class="p">,</span>
               <span class="n">nnodes_x1</span><span class="p">,</span><span class="n">nnodes_x2</span><span class="p">,[</span><span class="n">nnodes_x3</span><span class="p">,]</span>
               <span class="n">file_id</span><span class="p">,</span>
               <span class="n">error</span> <span class="p">)</span>
<span class="n">sll_xdmf_write_array</span><span class="p">(</span> <span class="n">mesh_name</span><span class="p">,</span>
                      <span class="k">array</span><span class="p">,</span>
                      <span class="n">array_name</span><span class="p">,</span>
                      <span class="n">error</span><span class="p">,</span>
                      <span class="n">xmffile_id</span><span class="p">,</span>
                      <span class="n">center</span> <span class="p">)</span>
<span class="n">sll_xdmf_close</span><span class="p">(</span><span class="n">file_id</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Where the parameters in brackets are used depending of the
dimensionality of the data.</p>
<dl class="simple myst">
<dt><code class="docutils literal notranslate"><span class="pre">sll_xdmf_open(</span> <span class="pre">)</span></code></dt><dd><p>opens a file with a given name and returns a file
identifier on <code class="docutils literal notranslate"><span class="pre">file_id</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sll_xdmf_write_array(</span> <span class="pre">)</span></code></dt><dd><p>writes a given multi-dimensional array on a file identified by <code class="docutils literal notranslate"><span class="pre">xmffile_id</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sll_xdmf_close(</span> <span class="pre">)</span></code></dt><dd><p>closes the given file.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is another library to manipulate xdmf files with object orienting approach.
<a class="reference external" href="https://selalib.github.io/selalib/namespacesll__m__xml.html">sll_xml</a></p>
</div>
</div>
<div class="section" id="critical-commentary">
<h3>Critical Commentary<a class="headerlink" href="#critical-commentary" title="Permalink to this headline">¶</a></h3>
<p>ECG: This interface can be improved. To consider:</p>
<p>The job of <code class="docutils literal notranslate"><span class="pre">sll_xdmf_open(</span> <span class="pre">)</span></code> should be to open a file, with a given
filename; it should take as parameters some flags to indicate what
behavior to exercise in case of error or if the file exists (overwrite?
append?) and nothing else. The nnodes parameters are used to write
XDMF-related preambles, but this should be sent to the other functions
that actually write into the file.</p>
<ul>
<li><p>The mesh_name parameter is not clear. Why mesh?</p>
<p><em>Mesh coordinates are written in a separate file, so you can write
it only one time at the beginning of the computation. When you plot
a field you still need to link your data to a mesh.</em></p>
</li>
<li><p>What is the ‘center’ parameter in the write_array() function?</p>
<p><em>When you plot field you can specify if your values are node centered or
cell centered</em></p>
</li>
</ul>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id13">1</a></span></dt>
<dd><p>We use the terms <em>mesh</em> and <em>grid</em> interchangeably.</p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id14">2</a></span></dt>
<dd><p>Or multiple coordinate transformations, in case that the physical
domain is represented by multiple patches.</p>
</dd>
</dl>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="user_guide.html" title="previous page">Preamble</a>
    <a class='right-next' id="next-link" href="mid_level.html" title="next page">Mid-Level Layer: Numerical and Parallel Utilities</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The SeLaLib project team<br/>
        
            &copy; Copyright 2020.<br/>
          Last updated on 10 Mar 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>